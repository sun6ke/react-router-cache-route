!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types"),require("react-router-dom")):"function"==typeof define&&define.amd?define(["exports","react","prop-types","react-router-dom"],t):t(e.CacheRoute={},e.React,e.PropTypes,e.reactRouterDom)}(this,function(e,w,t,u){"use strict";var g="default"in w?w.default:w;t=t&&t.hasOwnProperty("default")?t.default:t;function a(e){return void 0===e}function l(e){return null===e}function h(e){return"string"==typeof e}function n(e){return!(a(e)||l(e))}function r(e){return e instanceof Array}function O(e){return"number"==typeof e&&!function(e){return e!=e}(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var f=function(e){return"function"==typeof e},p=function(e,t,n){var r=1<arguments.length&&void 0!==t?t:[],o=n;try{O(r)&&(r=String(r));var c=(h(r)?r.split("."):r).reduce(function(e,t){return e[t]},e);return a(c)?o:c}catch(e){return o}},j=function(e,t){for(var n=arguments.length,r=Array(2<n?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];var c=1<arguments.length&&void 0!==t?t:[];c=h(c)?c.split("."):c;var a=p(e,c),i=p(e,c.slice(0,-1));return f(a)?a.call.apply(a,[i].concat(r)):a},m=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return a(e)?j(t):j(e)},void 0)},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function P(e,t){var n={};for(var r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},E=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,c=void 0;try{for(var a,i=e[Symbol.iterator]();!(r=(a=i.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,c=e}finally{try{!r&&i.return&&i.return()}finally{if(o)throw c}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},b=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},_="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:Function("return this")(),R="object"===("undefined"==typeof global?"undefined":o(global))&&global&&global.Math===Math&&global.Array===Array?global:_,S=p(R,"document.body"),T=p(R,"document.scrollingElement",p(R,"document.documentElement",{}));function N(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return e.scrollWidth>e.clientWidth||e.scrollHeight>e.clientHeight}function A(e){return f(p(R,"document.getElementById"))?[].concat(b(m(j(e,"querySelectorAll","*"),[])),[e]).filter(N):[]}function K(e){var t=[].concat(b(new Set([].concat(b(function n(e){return e.reduce(function(e,t){return[].concat(b(e),b(r(t)?n(t):[t]))},[])}((r(e)?e:[e]).map(A))),b([T,S].filter(N)))))).map(function(e){return[e,{x:e.scrollLeft,y:e.scrollTop}]});return function(){t.forEach(function(e){var t=E(e,2),n=t[0],r=t[1],o=r.x,c=r.y;n.scrollLeft=o,n.scrollTop=c})}}function M(){return Object.entries(W).filter(function(e){var t=E(e,2)[1];return t instanceof I?t.state.cached:Object.values(t).some(function(e){return e.state.cached})})}function k(){return C({},W)}function x(e,t){W[e]=t}function q(e){delete W[e]}function D(e){return j(e,"reset")}function F(e){var t=p(W,e);if(t)return t instanceof I?D(t):void Object.values(t).forEach(D)}function L(e){return n(e)&&!0!==p(e,V)}function U(e,t){var n=e.match,r=e.when,o=void 0===r?"forward":r;if(L(n)||(n=null),!t.cached&&n)return{cached:!0,matched:!0};if(t.matched&&!n){var c=p(e,"history.action"),a=!1;if(f(o))a=!o(e);else switch(o){case"always":break;case"back":["PUSH","REPLACE"].includes(c)&&(a=!0);break;case"forward":default:"POP"===c&&(a=!0)}if(a)return{cached:!1,matched:!1}}return{matched:!!n}}var B,W={},H=n(g.forwardRef),V="__isComputedUnmatch",I=(B=w.Component,y(X,B),c(X,[{key:"componentDidUpdate",value:function(e,t){if(t.cached&&this.state.cached)return!0===t.matched&&!1===this.state.matched?(this.props.unmount&&this.ejectDOM(),this.__cacheUpdateTime=Date.now(),j(this,"cacheLifecycles.__listener.didCache")):!1===t.matched&&!0===this.state.matched?(this.props.saveScrollPosition&&j(this.__revertScrollPos),this.__cacheUpdateTime=Date.now(),j(this,"cacheLifecycles.__listener.didRecover")):void 0}},{key:"shouldComponentUpdate",value:function(e,t){var n=!1===this.state.matched&&!0===t.matched,r=!0===this.state.cached&&!1===t.cached,o=this.state.matched||t.matched||this.state.cached!==t.cached;return o&&((this.props.unmount&&r||n)&&this.injectDOM(),r||n||!this.props.saveScrollPosition||(this.__revertScrollPos=K(this.props.unmount?this.wrapper:void 0))),o}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.cacheKey,n=e.unmount;if(p(t,"multiple")){var r=t.cacheKey,o=t.pathname,c=C({},k()[r]);delete c[o],0===Object.keys(c).length?q(r):x(r,c)}else q(t);n&&this.injectDOM()}},{key:"render",value:function(){var t=this,e=this.state,n=e.matched,r=e.cached,o=this.props,c=o.className,a=void 0===c?"":c,i=o.behavior,u=o.children,l=m(j(i,void 0,!n),{}),h=l.className,s=void 0===h?"":h,f=P(l,["className"]),p=j(a+" "+s,"trim"),d=""!==p;return r?g.createElement("div",C({className:d?p:void 0},f,{ref:function(e){t.wrapper=e}}),j(u,void 0,this.cacheLifecycles)):null}}]),X);function X(e){var t;s(this,X);for(var n=arguments.length,r=Array(1<n?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var c=v(this,(t=X.__proto__||Object.getPrototypeOf(X)).call.apply(t,[this,e].concat(r)));if(c.cacheLifecycles={__listener:{},didCache:function(e){c.cacheLifecycles.__listener.didCache=e},didRecover:function(e){c.cacheLifecycles.__listener.didRecover=e}},c.componentWillReceiveProps=H?void 0:function(e){var t=U(e,c.state);c.setState(t)},c.injectDOM=function(){try{j(c.__parentNode,"insertBefore",c.wrapper,c.__placeholderNode),j(c.__parentNode,"removeChild",c.__placeholderNode)}catch(e){}},c.ejectDOM=function(){try{var e=p(c.wrapper,"parentNode");c.__parentNode=e,j(c.__parentNode,"insertBefore",c.__placeholderNode,c.wrapper),j(c.__parentNode,"removeChild",c.wrapper)}catch(e){}},c.reset=function(){return delete c.__revertScrollPos,new Promise(function(e,t){c.setState({cached:!1},e)})},c.__cacheCreateTime=Date.now(),c.__cacheUpdateTime=c.__cacheCreateTime,e.cacheKey)if(p(e.cacheKey,"multiple")){var a=e.cacheKey,i=a.cacheKey,u=a.pathname;x(i,C({},k()[i],d({},u,c)))}else x(e.cacheKey,c);return"undefined"!=typeof document&&(c.__placeholderNode=document.createComment(" Route cached "+(e.cacheKey?'with cacheKey: "'+p(e.cacheKey,"cacheKey",e.cacheKey)+'" ':""))),c.state=U(e,{cached:!1,matched:!1}),c}I.propsTypes={history:t.object.isRequired,match:t.object.isRequired,children:t.func.isRequired,className:t.string,when:t.oneOfType([t.func,t.oneOf(["forward","back","always"])]),behavior:t.func,unmount:t.bool,saveScrollPosition:t.bool},I.defaultProps={when:"forward",unmount:!1,saveScrollPosition:!1,behavior:function(e){return e?{style:{display:"none"}}:void 0}},I.getDerivedStateFromProps=H?U:void 0;var z,G=(z=w.Component,y(J,z),J);function J(){var e,t,n;s(this,J);for(var r=arguments.length,o=Array(r),c=0;c<r;c++)o[c]=arguments[c];return(t=n=v(this,(e=J.__proto__||Object.getPrototypeOf(J)).call.apply(e,[this].concat(o)))).render=function(){return j(n.props,"children")},n.shouldComponentUpdate=function(e){return e.when},v(n,t)}G.propsTypes={when:t.bool.isRequired};var Q,Y=n(w.Fragment),Z=(Q=w.Component,y($,Q),c($,[{key:"render",value:function(){var o=this,e=this.props,h=e.children,s=e.render,f=e.component,p=e.className,d=e.when,m=e.behavior,y=e.cacheKey,v=e.unmount,b=e.saveScrollPosition,t=e.computedMatchForCacheRoute,_=e.multiple,n=P(e,["children","render","component","className","when","behavior","cacheKey","unmount","saveScrollPosition","computedMatchForCacheRoute","multiple"]);return!g.isValidElement(h)&&function(e){return 0===g.Children.count(e)}(h)||(s=function(){return h}),t&&(n.computedMatch=t),_&&!Y&&(_=!1),O(_)&&(_=function(e,t,n){var r=2<arguments.length&&void 0!==n?n:Number.MAX_VALUE;return e<t?t:r<e?r:e}(_,1)),g.createElement(u.Route,n,function(c){function e(t){return g.createElement(I,t,function(e){return g.createElement(G,{when:L(t.match)},function(){return Object.assign(t,{cacheLifecycles:e}),f?g.createElement(f,t):j(s||h,void 0,t)})})}var a=c.match,i=c.computedMatch,t=c.location,n=L(c.match),u=t.pathname,r=O(_)?_:1/0,l={when:d,className:p,behavior:m,cacheKey:y,unmount:v,saveScrollPosition:b};return _&&n&&(o.cache[u]={updateTime:Date.now(),render:e},Object.entries(o.cache).sort(function(e,t){var n=E(e,2)[1];return E(t,2)[1].updateTime-n.updateTime}).forEach(function(e,t){var n=E(e,1)[0];r<=t&&delete o.cache[n]})),_?g.createElement(w.Fragment,null,Object.entries(o.cache).map(function(e){var t=E(e,2),n=t[0],r=t[1].render,o=n===u?a||i:null;return g.createElement(w.Fragment,{key:n},r(C({},c,l,{cacheKey:y?{cacheKey:y,pathname:n,multiple:!0}:void 0,key:n,match:o})))})):e(C({},c,l))})}}]),$);function $(){var e,t,n;s(this,$);for(var r=arguments.length,o=Array(r),c=0;c<r;c++)o[c]=arguments[c];return(t=n=v(this,(e=$.__proto__||Object.getPrototypeOf($)).call.apply(e,[this].concat(o)))).cache={},v(n,t)}Z.componentName="CacheRoute",Z.propTypes={component:t.elementType||t.any,render:t.func,children:t.oneOfType([t.func,t.node]),computedMatchForCacheRoute:t.object,multiple:t.oneOfType([t.bool,t.number])},Z.defaultProps={multiple:!1};var ee=n(w.Fragment)?function(e){var t=e.children;return g.createElement(w.Fragment,null,t)}:n(w.PropTypes)?function(e){var t=e.children;return g.createElement("div",null,t)}:function(e){return e.children};ee.displayName="SwitchFragment";var te,ne=n(u.__RouterContext),re=(te=u.Switch,y(oe,te),c(oe,[{key:"render",value:function(){var e=this.props,t=e.children,o=e.which,n=this.getContext(),c=n.location,a=n.match,i=!1;return g.createElement(G,{when:L(a)},function(){return g.createElement(ee,null,g.Children.map(t,function(e){if(!g.isValidElement(e))return null;var t=e.props.path||e.props.from,n=i?null:t?u.matchPath(c.pathname,C({},e.props,{path:t}),a):a,r=void 0;return r=o(e)?g.cloneElement(e,C({location:c,computedMatch:n},l(n)?{computedMatchForCacheRoute:d({},V,!0)}:null)):n&&!i?g.cloneElement(e,{location:c,computedMatch:n}):null,i=i||!!n,r}))})}}]),oe);function oe(){var e,t,n;s(this,oe);for(var r=arguments.length,o=Array(r),c=0;c<r;c++)o[c]=arguments[c];return(t=n=v(this,(e=oe.__proto__||Object.getPrototypeOf(oe)).call.apply(e,[this].concat(o)))).getContext=function(){if(ne){var e=n.props;return{location:e.location,match:e.match}}var t=n.context.router.route;return{location:n.props.location||t.location,match:t.match}},v(n,t)}ne?(re.propTypes={children:t.node,location:t.object.isRequired,match:t.object.isRequired,which:t.func},re=u.withRouter(re)):(re.contextTypes={router:t.shape({route:t.object.isRequired}).isRequired},re.propTypes={children:t.node,location:t.object,which:t.func}),re.defaultProps={which:function(e){return p(e,"type")===Z}};var ce=re;e.default=Z,e.CacheRoute=Z,e.CacheSwitch=ce,e.dropByCacheKey=F,e.getCachingKeys=function(){return M().map(function(e){return E(e,1)[0]})},e.clearCache=function(){M().forEach(function(e){var t=E(e,1)[0];return F(t)})},e.getCachingComponents=function(){return M().reduce(function(e,t){var n=E(t,2),c=n[0],r=n[1];return C({},e,r instanceof I?d({},c,r):Object.entries(r).reduce(function(e,t){var n=E(t,2),r=n[0],o=n[1];return C({},e,d({},c+"."+r,o))},{}))},{})},Object.defineProperty(e,"__esModule",{value:!0})});
